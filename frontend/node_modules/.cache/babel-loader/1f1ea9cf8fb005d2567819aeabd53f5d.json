{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar _a;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMoMixin = exports.DirectionVH = void 0;\n\nvar BBox_js_1 = require(\"../../../util/BBox.js\");\n\nvar string_js_1 = require(\"../../../util/string.js\");\n\nvar FontData_js_1 = require(\"../FontData.js\");\n\nexports.DirectionVH = (_a = {}, _a[1] = 'v', _a[2] = 'h', _a);\n\nfunction CommonMoMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n\n      _this.size = null;\n      _this.isAccent = _this.node.isAccent;\n      return _this;\n    }\n\n    class_1.prototype.computeBBox = function (bbox, _recompute) {\n      if (_recompute === void 0) {\n        _recompute = false;\n      }\n\n      this.protoBBox(bbox);\n\n      if (this.node.attributes.get('symmetric') && this.stretch.dir !== 2) {\n        var d = this.getCenterOffset(bbox);\n        bbox.h += d;\n        bbox.d -= d;\n      }\n\n      if (this.node.getProperty('mathaccent') && (this.stretch.dir === 0 || this.size >= 0)) {\n        bbox.w = 0;\n      }\n    };\n\n    class_1.prototype.protoBBox = function (bbox) {\n      var stretchy = this.stretch.dir !== 0;\n\n      if (stretchy && this.size === null) {\n        this.getStretchedVariant([0]);\n      }\n\n      if (stretchy && this.size < 0) return;\n\n      _super.prototype.computeBBox.call(this, bbox);\n\n      this.copySkewIC(bbox);\n    };\n\n    class_1.prototype.getAccentOffset = function () {\n      var bbox = BBox_js_1.BBox.empty();\n      this.protoBBox(bbox);\n      return -bbox.w / 2;\n    };\n\n    class_1.prototype.getCenterOffset = function (bbox) {\n      if (bbox === void 0) {\n        bbox = null;\n      }\n\n      if (!bbox) {\n        bbox = BBox_js_1.BBox.empty();\n\n        _super.prototype.computeBBox.call(this, bbox);\n      }\n\n      return (bbox.h + bbox.d) / 2 + this.font.params.axis_height - bbox.h;\n    };\n\n    class_1.prototype.getVariant = function () {\n      if (this.node.attributes.get('largeop')) {\n        this.variant = this.node.attributes.get('displaystyle') ? '-largeop' : '-smallop';\n        return;\n      }\n\n      if (!this.node.attributes.getExplicit('mathvariant') && this.node.getProperty('pseudoscript') === false) {\n        this.variant = '-tex-variant';\n        return;\n      }\n\n      _super.prototype.getVariant.call(this);\n    };\n\n    class_1.prototype.canStretch = function (direction) {\n      if (this.stretch.dir !== 0) {\n        return this.stretch.dir === direction;\n      }\n\n      var attributes = this.node.attributes;\n      if (!attributes.get('stretchy')) return false;\n      var c = this.getText();\n      if (Array.from(c).length !== 1) return false;\n      var delim = this.font.getDelimiter(c.codePointAt(0));\n      this.stretch = delim && delim.dir === direction ? delim : FontData_js_1.NOSTRETCH;\n      return this.stretch.dir !== 0;\n    };\n\n    class_1.prototype.getStretchedVariant = function (WH, exact) {\n      var e_1, _a;\n\n      if (exact === void 0) {\n        exact = false;\n      }\n\n      if (this.stretch.dir !== 0) {\n        var D = this.getWH(WH);\n        var min = this.getSize('minsize', 0);\n        var max = this.getSize('maxsize', Infinity);\n        var mathaccent = this.node.getProperty('mathaccent');\n        D = Math.max(min, Math.min(max, D));\n        var df = this.font.params.delimiterfactor / 1000;\n        var ds = this.font.params.delimitershortfall;\n        var m = min || exact ? D : mathaccent ? Math.min(D / df, D + ds) : Math.max(D * df, D - ds);\n        var delim = this.stretch;\n        var c = delim.c || this.getText().codePointAt(0);\n        var i = 0;\n\n        if (delim.sizes) {\n          try {\n            for (var _b = __values(delim.sizes), _c = _b.next(); !_c.done; _c = _b.next()) {\n              var d = _c.value;\n\n              if (d >= m) {\n                if (mathaccent && i) {\n                  i--;\n                }\n\n                this.variant = this.font.getSizeVariant(c, i);\n                this.size = i;\n\n                if (delim.schar && delim.schar[i]) {\n                  this.stretch = __assign(__assign({}, this.stretch), {\n                    c: delim.schar[i]\n                  });\n                }\n\n                return;\n              }\n\n              i++;\n            }\n          } catch (e_1_1) {\n            e_1 = {\n              error: e_1_1\n            };\n          } finally {\n            try {\n              if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            } finally {\n              if (e_1) throw e_1.error;\n            }\n          }\n        }\n\n        if (delim.stretch) {\n          this.size = -1;\n          this.invalidateBBox();\n          this.getStretchBBox(WH, this.checkExtendedHeight(D, delim), delim);\n        } else {\n          this.variant = this.font.getSizeVariant(c, i - 1);\n          this.size = i - 1;\n        }\n      }\n    };\n\n    class_1.prototype.getSize = function (name, value) {\n      var attributes = this.node.attributes;\n\n      if (attributes.isSet(name)) {\n        value = this.length2em(attributes.get(name), 1, 1);\n      }\n\n      return value;\n    };\n\n    class_1.prototype.getWH = function (WH) {\n      if (WH.length === 0) return 0;\n      if (WH.length === 1) return WH[0];\n\n      var _a = __read(WH, 2),\n          H = _a[0],\n          D = _a[1];\n\n      var a = this.font.params.axis_height;\n      return this.node.attributes.get('symmetric') ? 2 * Math.max(H - a, D + a) : H + D;\n    };\n\n    class_1.prototype.getStretchBBox = function (WHD, D, C) {\n      var _a;\n\n      if (C.hasOwnProperty('min') && C.min > D) {\n        D = C.min;\n      }\n\n      var _b = __read(C.HDW, 3),\n          h = _b[0],\n          d = _b[1],\n          w = _b[2];\n\n      if (this.stretch.dir === 1) {\n        _a = __read(this.getBaseline(WHD, D, C), 2), h = _a[0], d = _a[1];\n      } else {\n        w = D;\n      }\n\n      this.bbox.h = h;\n      this.bbox.d = d;\n      this.bbox.w = w;\n    };\n\n    class_1.prototype.getBaseline = function (WHD, HD, C) {\n      var hasWHD = WHD.length === 2 && WHD[0] + WHD[1] === HD;\n      var symmetric = this.node.attributes.get('symmetric');\n\n      var _a = __read(hasWHD ? WHD : [HD, 0], 2),\n          H = _a[0],\n          D = _a[1];\n\n      var _b = __read([H + D, 0], 2),\n          h = _b[0],\n          d = _b[1];\n\n      if (symmetric) {\n        var a = this.font.params.axis_height;\n\n        if (hasWHD) {\n          h = 2 * Math.max(H - a, D + a);\n        }\n\n        d = h / 2 - a;\n      } else if (hasWHD) {\n        d = D;\n      } else {\n        var _c = __read(C.HDW || [.75, .25], 2),\n            ch = _c[0],\n            cd = _c[1];\n\n        d = cd * (h / (ch + cd));\n      }\n\n      return [h - d, d];\n    };\n\n    class_1.prototype.checkExtendedHeight = function (D, C) {\n      if (C.fullExt) {\n        var _a = __read(C.fullExt, 2),\n            extSize = _a[0],\n            endSize = _a[1];\n\n        var n = Math.ceil(Math.max(0, D - endSize) / extSize);\n        D = endSize + n * extSize;\n      }\n\n      return D;\n    };\n\n    class_1.prototype.remapChars = function (chars) {\n      var primes = this.node.getProperty('primes');\n\n      if (primes) {\n        return string_js_1.unicodeChars(primes);\n      }\n\n      if (chars.length === 1) {\n        var parent_1 = this.node.coreParent().parent;\n        var isAccent = this.isAccent && !parent_1.isKind('mrow');\n        var map = isAccent ? 'accent' : 'mo';\n        var text = this.font.getRemappedChar(map, chars[0]);\n\n        if (text) {\n          chars = this.unicodeChars(text, this.variant);\n        }\n      }\n\n      return chars;\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMoMixin = CommonMoMixin;","map":{"version":3,"mappings":"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","names":["exports","_a","CommonMoMixin","Base","__extends","args","_this","isAccent","node","class_1","bbox","_recompute","protoBBox","attributes","get","stretch","dir","d","getCenterOffset","h","getProperty","size","w","stretchy","getStretchedVariant","_super","computeBBox","call","copySkewIC","BBox_js_1","empty","font","params","axis_height","variant","getExplicit","getVariant","direction","c","getText","Array","from","length","delim","getDelimiter","codePointAt","FontData_js_1","WH","exact","D","getWH","min","getSize","max","Infinity","mathaccent","Math","df","delimiterfactor","ds","delimitershortfall","m","i","sizes","_c","getSizeVariant","schar","__assign","invalidateBBox","getStretchBBox","checkExtendedHeight","name","value","isSet","length2em","H","a","WHD","C","hasOwnProperty","HDW","getBaseline","HD","hasWHD","symmetric","ch","cd","fullExt","extSize","endSize","n","ceil","chars","primes","string_js_1","parent_1","coreParent","parent","isKind","map","text","getRemappedChar","unicodeChars"],"sources":["/home/kinzoku99/Desktop/ProjectIO/frontend/node_modules/mathjax-full/ts/output/common/Wrappers/mo.ts"],"sourcesContent":["/*************************************************************\n *\n *  Copyright (c) 2017-2021 The MathJax Consortium\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n\n/**\n * @fileoverview  Implements the CommonMo wrapper mixin for the MmlMo object\n *\n * @author dpvc@mathjax.org (Davide Cervone)\n */\n\nimport {AnyWrapper, WrapperConstructor, Constructor} from '../Wrapper.js';\nimport {MmlMo} from '../../../core/MmlTree/MmlNodes/mo.js';\nimport {BBox} from '../../../util/BBox.js';\nimport {unicodeChars} from '../../../util/string.js';\nimport {DelimiterData} from '../FontData.js';\nimport {DIRECTION, NOSTRETCH} from '../FontData.js';\n\n/*****************************************************************/\n/**\n * Convert direction to letter\n */\nexport const DirectionVH: {[n: number]: string} = {\n  [DIRECTION.Vertical]: 'v',\n  [DIRECTION.Horizontal]: 'h'\n};\n\n/*****************************************************************/\n/**\n * The CommonMo interface\n */\nexport interface CommonMo extends AnyWrapper {\n\n  /**\n   * The font size that a stretched operator uses.\n   * If -1, then stretch arbitrarily, and bbox gives the actual height, depth, width\n   */\n  size: number;\n\n  /**\n   * True if used as an accent in an munderover construct\n   */\n  isAccent: boolean;\n\n  /**\n   * Get the (unmodified) bbox of the contents (before centering or setting accents to width 0)\n   *\n   * @param {BBox} bbox   The bbox to fill\n   */\n  protoBBox(bbox: BBox): void;\n\n  /**\n   * @return {number}    Offset to the left by half the actual width of the accent\n   */\n  getAccentOffset(): number;\n\n  /**\n   * @param {BBox} bbox   The bbox to center, or null to compute the bbox\n   * @return {number}     The offset to move the glyph to center it\n   */\n  getCenterOffset(bbox?: BBox): number;\n\n  /**\n   * Determint variant for vertically/horizontally stretched character\n   *\n   * @param {number[]} WH  size to stretch to, either [W] or [H, D]\n   * @param {boolean} exact  True if not allowed to use delimiter factor and shortfall\n   */\n  getStretchedVariant(WH: number[], exact?: boolean): void;\n\n  /**\n   * @param {string} name   The name of the attribute to get\n   * @param {number} value  The default value to use\n   * @return {number}       The size in em's of the attribute (or the default value)\n   */\n  getSize(name: string, value: number): number;\n\n  /**\n   * @param {number[]} WH  Either [W] for width, [H, D] for height and depth, or [] for min/max size\n   * @return {number}      Either the width or the total height of the character\n   */\n  getWH(WH: number[]): number;\n\n  /**\n   * @param {number[]} WHD     The [W] or [H, D] being requested from the parent mrow\n   * @param {number} D         The full dimension (including symmetry, etc)\n   * @param {DelimiterData} C  The delimiter data for the stretchy character\n   */\n  getStretchBBox(WHD: number[], D: number, C: DelimiterData): void;\n\n  /**\n   * @param {number[]} WHD     The [H, D] being requested from the parent mrow\n   * @param {number} HD        The full height (including symmetry, etc)\n   * @param {DelimiterData} C  The delimiter data for the stretchy character\n   * @return {number[]}        The height and depth for the vertically stretched delimiter\n   */\n  getBaseline(WHD: number[], HD: number, C: DelimiterData): number[];\n\n  /**\n   * Determine the size of the delimiter based on whether full extenders should be used or not.\n   *\n   * @param {number} D          The requested size of the delimiter\n   * @param {DelimiterData} C   The data for the delimiter\n   * @return {number}           The final size of the assembly\n   */\n  checkExtendedHeight(D: number, C: DelimiterData): number;\n\n}\n\n/**\n * Shorthand for the CommonMo constructor\n */\nexport type MoConstructor = Constructor<CommonMo>;\n\n/*****************************************************************/\n/**\n * The CommomMo wrapper mixin for the MmlMo object\n *\n * @template T  The Wrapper class constructor type\n */\nexport function CommonMoMixin<T extends WrapperConstructor>(Base: T): MoConstructor & T {\n\n  return class extends Base {\n\n    /**\n     * The font size that a stretched operator uses.\n     * If -1, then stretch arbitrarily, and bbox gives the actual height, depth, width\n     */\n    public size: number = null;\n\n    /**\n     * True if used as an accent in an munderover construct\n     */\n    public isAccent: boolean;\n\n    /**\n     * @override\n     */\n    constructor(...args: any[]) {\n      super(...args);\n      this.isAccent = (this.node as MmlMo).isAccent;\n    }\n\n    /**\n     * @override\n     */\n    public computeBBox(bbox: BBox, _recompute: boolean = false) {\n      this.protoBBox(bbox);\n      if (this.node.attributes.get('symmetric') &&\n          this.stretch.dir !== DIRECTION.Horizontal) {\n        const d = this.getCenterOffset(bbox);\n        bbox.h += d;\n        bbox.d -= d;\n      }\n      if (this.node.getProperty('mathaccent') &&\n          (this.stretch.dir === DIRECTION.None || this.size >= 0)) {\n        bbox.w = 0;\n      }\n    }\n\n    /**\n     * Get the (unmodified) bbox of the contents (before centering or setting accents to width 0)\n     *\n     * @param {BBox} bbox   The bbox to fill\n     */\n    public protoBBox(bbox: BBox) {\n      const stretchy = (this.stretch.dir !== DIRECTION.None);\n      if (stretchy && this.size === null) {\n        this.getStretchedVariant([0]);\n      }\n      if (stretchy && this.size < 0) return;\n      super.computeBBox(bbox);\n      this.copySkewIC(bbox);\n    }\n\n    /**\n     * @return {number}    Offset to the left by half the actual width of the accent\n     */\n    public getAccentOffset(): number {\n      const bbox = BBox.empty();\n      this.protoBBox(bbox);\n      return -bbox.w / 2;\n    }\n\n    /**\n     * @param {BBox} bbox   The bbox to center, or null to compute the bbox\n     * @return {number}     The offset to move the glyph to center it\n     */\n    public getCenterOffset(bbox: BBox = null): number {\n      if (!bbox) {\n        bbox = BBox.empty();\n        super.computeBBox(bbox);\n      }\n      return ((bbox.h + bbox.d) / 2 + this.font.params.axis_height) - bbox.h;\n    }\n\n    /**\n     * @override\n     */\n    public getVariant() {\n      if (this.node.attributes.get('largeop')) {\n        this.variant = (this.node.attributes.get('displaystyle') ? '-largeop' : '-smallop');\n        return;\n      }\n      if (!this.node.attributes.getExplicit('mathvariant') &&\n          this.node.getProperty('pseudoscript') === false) {\n        this.variant = '-tex-variant';\n        return;\n      }\n      super.getVariant();\n    }\n\n    /**\n     * @override\n     */\n    public canStretch(direction: DIRECTION) {\n      if (this.stretch.dir !== DIRECTION.None) {\n        return this.stretch.dir === direction;\n      }\n      const attributes = this.node.attributes;\n      if (!attributes.get('stretchy')) return false;\n      const c = this.getText();\n      if (Array.from(c).length !== 1) return false;\n      const delim = this.font.getDelimiter(c.codePointAt(0));\n      this.stretch = (delim && delim.dir === direction ? delim : NOSTRETCH);\n      return this.stretch.dir !== DIRECTION.None;\n    }\n\n    /**\n     * Determint variant for vertically/horizontally stretched character\n     *\n     * @param {number[]} WH  size to stretch to, either [W] or [H, D]\n     * @param {boolean} exact  True if not allowed to use delimiter factor and shortfall\n     */\n    public getStretchedVariant(WH: number[], exact: boolean = false) {\n      if (this.stretch.dir !== DIRECTION.None) {\n        let D = this.getWH(WH);\n        const min = this.getSize('minsize', 0);\n        const max = this.getSize('maxsize', Infinity);\n        const mathaccent = this.node.getProperty('mathaccent');\n        //\n        //  Clamp the dimension to the max and min\n        //  then get the target size via TeX rules\n        //\n        D = Math.max(min, Math.min(max, D));\n        const df = this.font.params.delimiterfactor / 1000;\n        const ds = this.font.params.delimitershortfall;\n        const m = (min || exact ? D : mathaccent ? Math.min(D / df, D + ds) :  Math.max(D * df, D - ds));\n        //\n        //  Look through the delimiter sizes for one that matches\n        //\n        const delim = this.stretch;\n        const c = delim.c || this.getText().codePointAt(0);\n        let i = 0;\n        if (delim.sizes) {\n          for (const d of delim.sizes) {\n            if (d >= m) {\n              if (mathaccent && i) {\n                i--;\n              }\n              this.variant = this.font.getSizeVariant(c, i);\n              this.size = i;\n              if (delim.schar && delim.schar[i]) {\n                this.stretch = {...this.stretch, c: delim.schar[i]};\n              }\n              return;\n            }\n            i++;\n          }\n        }\n        //\n        //  No size matches, so if we can make multi-character delimiters,\n        //  record the data for that, otherwise, use the largest fixed size.\n        //\n        if (delim.stretch) {\n          this.size = -1;\n          this.invalidateBBox();\n          this.getStretchBBox(WH, this.checkExtendedHeight(D, delim), delim);\n        } else {\n          this.variant = this.font.getSizeVariant(c, i - 1);\n          this.size = i - 1;\n        }\n      }\n    }\n\n    /**\n     * @param {string} name   The name of the attribute to get\n     * @param {number} value  The default value to use\n     * @return {number}       The size in em's of the attribute (or the default value)\n     */\n    public getSize(name: string, value: number): number {\n      let attributes = this.node.attributes;\n      if (attributes.isSet(name)) {\n        value = this.length2em(attributes.get(name), 1, 1); // FIXME: should use height of actual character\n      }\n      return value;\n    }\n\n    /**\n     * @param {number[]} WH  Either [W] for width, [H, D] for height and depth, or [] for min/max size\n     * @return {number}      Either the width or the total height of the character\n     */\n    public getWH(WH: number[]): number {\n      if (WH.length === 0) return 0;\n      if (WH.length === 1) return WH[0];\n      let [H, D] = WH;\n      const a = this.font.params.axis_height;\n      return (this.node.attributes.get('symmetric') ? 2 * Math.max(H - a, D + a) : H + D);\n    }\n\n    /**\n     * @param {number[]} WHD     The [W] or [H, D] being requested from the parent mrow\n     * @param {number} D         The full dimension (including symmetry, etc)\n     * @param {DelimiterData} C  The delimiter data for the stretchy character\n     */\n    public getStretchBBox(WHD: number[], D: number, C: DelimiterData) {\n      if (C.hasOwnProperty('min') && C.min > D) {\n        D = C.min;\n      }\n      let [h, d, w] = C.HDW;\n      if (this.stretch.dir === DIRECTION.Vertical) {\n        [h, d] = this.getBaseline(WHD, D, C);\n      } else {\n        w = D;\n      }\n      this.bbox.h = h;\n      this.bbox.d = d;\n      this.bbox.w = w;\n    }\n\n    /**\n     * @param {number[]} WHD     The [H, D] being requested from the parent mrow\n     * @param {number} HD        The full height (including symmetry, etc)\n     * @param {DelimiterData} C  The delimiter data for the stretchy character\n     * @return {[number, number]}        The height and depth for the vertically stretched delimiter\n     */\n    public getBaseline(WHD: number[], HD: number, C: DelimiterData): [number, number] {\n      const hasWHD = (WHD.length === 2 && WHD[0] + WHD[1] === HD);\n      const symmetric = this.node.attributes.get('symmetric');\n      const [H, D] = (hasWHD ? WHD : [HD, 0]);\n      let [h, d] = [H + D, 0];\n      if (symmetric) {\n        //\n        //  Center on the math axis\n        //\n        const a = this.font.params.axis_height;\n        if (hasWHD) {\n          h = 2 * Math.max(H - a, D + a);\n        }\n        d = h / 2 - a;\n      } else if (hasWHD) {\n        //\n        //  Use the given depth (from mrow)\n        //\n        d = D;\n      } else {\n        //\n        //  Use depth proportional to the normal-size character\n        //  (when stretching for minsize or maxsize by itself)\n        //\n        let [ch, cd] = (C.HDW || [.75, .25]);\n        d = cd * (h / (ch + cd));\n      }\n      return [h - d, d];\n    }\n\n    /**\n     * @override\n     */\n    public checkExtendedHeight(D: number, C: DelimiterData): number {\n      if (C.fullExt) {\n        const [extSize, endSize] = C.fullExt;\n        const n = Math.ceil(Math.max(0, D - endSize) / extSize);\n        D = endSize + n * extSize;\n      }\n      return D;\n    }\n\n    /**\n     * @override\n     */\n    public remapChars(chars: number[]) {\n      const primes = this.node.getProperty('primes') as string;\n      if (primes) {\n        return unicodeChars(primes);\n      }\n      if (chars.length === 1) {\n        const parent = (this.node as MmlMo).coreParent().parent;\n        const isAccent = this.isAccent && !parent.isKind('mrow');\n        const map = (isAccent ? 'accent' : 'mo');\n        const text = this.font.getRemappedChar(map, chars[0]);\n        if (text) {\n          chars = this.unicodeChars(text, this.variant);\n        }\n      }\n      return chars;\n    }\n\n  };\n\n}\n"]},"metadata":{},"sourceType":"script"}