{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonWrapper = void 0;\n\nvar Wrapper_js_1 = require(\"../../core/Tree/Wrapper.js\");\n\nvar MmlNode_js_1 = require(\"../../core/MmlTree/MmlNode.js\");\n\nvar string_js_1 = require(\"../../util/string.js\");\n\nvar LENGTHS = require(\"../../util/lengths.js\");\n\nvar Styles_js_1 = require(\"../../util/Styles.js\");\n\nvar BBox_js_1 = require(\"../../util/BBox.js\");\n\nvar FontData_js_1 = require(\"./FontData.js\");\n\nvar SMALLSIZE = 2 / 18;\n\nfunction MathMLSpace(script, size) {\n  return script ? size < SMALLSIZE ? 0 : SMALLSIZE : size;\n}\n\nvar CommonWrapper = function (_super) {\n  __extends(CommonWrapper, _super);\n\n  function CommonWrapper(factory, node, parent) {\n    if (parent === void 0) {\n      parent = null;\n    }\n\n    var _this = _super.call(this, factory, node) || this;\n\n    _this.parent = null;\n    _this.removedStyles = null;\n    _this.styles = null;\n    _this.variant = '';\n    _this.bboxComputed = false;\n    _this.stretch = FontData_js_1.NOSTRETCH;\n    _this.font = null;\n    _this.parent = parent;\n    _this.font = factory.jax.font;\n    _this.bbox = BBox_js_1.BBox.zero();\n\n    _this.getStyles();\n\n    _this.getVariant();\n\n    _this.getScale();\n\n    _this.getSpace();\n\n    _this.childNodes = node.childNodes.map(function (child) {\n      var wrapped = _this.wrap(child);\n\n      if (wrapped.bbox.pwidth && (node.notParent || node.isKind('math'))) {\n        _this.bbox.pwidth = BBox_js_1.BBox.fullWidth;\n      }\n\n      return wrapped;\n    });\n    return _this;\n  }\n\n  Object.defineProperty(CommonWrapper.prototype, \"jax\", {\n    get: function () {\n      return this.factory.jax;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"adaptor\", {\n    get: function () {\n      return this.factory.jax.adaptor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"metrics\", {\n    get: function () {\n      return this.factory.jax.math.metrics;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"fixesPWidth\", {\n    get: function () {\n      return !this.node.notParent && !this.node.isToken;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  CommonWrapper.prototype.wrap = function (node, parent) {\n    if (parent === void 0) {\n      parent = null;\n    }\n\n    var wrapped = this.factory.wrap(node, parent || this);\n\n    if (parent) {\n      parent.childNodes.push(wrapped);\n    }\n\n    this.jax.nodeMap.set(node, wrapped);\n    return wrapped;\n  };\n\n  CommonWrapper.prototype.getBBox = function (save) {\n    if (save === void 0) {\n      save = true;\n    }\n\n    if (this.bboxComputed) {\n      return this.bbox;\n    }\n\n    var bbox = save ? this.bbox : BBox_js_1.BBox.zero();\n    this.computeBBox(bbox);\n    this.bboxComputed = save;\n    return bbox;\n  };\n\n  CommonWrapper.prototype.computeBBox = function (bbox, recompute) {\n    var e_1, _a;\n\n    if (recompute === void 0) {\n      recompute = false;\n    }\n\n    bbox.empty();\n\n    try {\n      for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var child = _c.value;\n        bbox.append(child.getBBox());\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    bbox.clean();\n\n    if (this.fixesPWidth && this.setChildPWidths(recompute)) {\n      this.computeBBox(bbox, true);\n    }\n  };\n\n  CommonWrapper.prototype.setChildPWidths = function (recompute, w, clear) {\n    var e_2, _a;\n\n    if (w === void 0) {\n      w = null;\n    }\n\n    if (clear === void 0) {\n      clear = true;\n    }\n\n    if (recompute) {\n      return false;\n    }\n\n    if (clear) {\n      this.bbox.pwidth = '';\n    }\n\n    var changed = false;\n\n    try {\n      for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var child = _c.value;\n        var cbox = child.getBBox();\n\n        if (cbox.pwidth && child.setChildPWidths(recompute, w === null ? cbox.w : w, clear)) {\n          changed = true;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return changed;\n  };\n\n  CommonWrapper.prototype.invalidateBBox = function () {\n    if (this.bboxComputed) {\n      this.bboxComputed = false;\n\n      if (this.parent) {\n        this.parent.invalidateBBox();\n      }\n    }\n  };\n\n  CommonWrapper.prototype.copySkewIC = function (bbox) {\n    var first = this.childNodes[0];\n\n    if (first === null || first === void 0 ? void 0 : first.bbox.sk) {\n      bbox.sk = first.bbox.sk;\n    }\n\n    if (first === null || first === void 0 ? void 0 : first.bbox.dx) {\n      bbox.dx = first.bbox.dx;\n    }\n\n    var last = this.childNodes[this.childNodes.length - 1];\n\n    if (last === null || last === void 0 ? void 0 : last.bbox.ic) {\n      bbox.ic = last.bbox.ic;\n      bbox.w += bbox.ic;\n    }\n  };\n\n  CommonWrapper.prototype.getStyles = function () {\n    var styleString = this.node.attributes.getExplicit('style');\n    if (!styleString) return;\n    var style = this.styles = new Styles_js_1.Styles(styleString);\n\n    for (var i = 0, m = CommonWrapper.removeStyles.length; i < m; i++) {\n      var id = CommonWrapper.removeStyles[i];\n\n      if (style.get(id)) {\n        if (!this.removedStyles) this.removedStyles = {};\n        this.removedStyles[id] = style.get(id);\n        style.set(id, '');\n      }\n    }\n  };\n\n  CommonWrapper.prototype.getVariant = function () {\n    if (!this.node.isToken) return;\n    var attributes = this.node.attributes;\n    var variant = attributes.get('mathvariant');\n\n    if (!attributes.getExplicit('mathvariant')) {\n      var values = attributes.getList('fontfamily', 'fontweight', 'fontstyle');\n\n      if (this.removedStyles) {\n        var style = this.removedStyles;\n        if (style.fontFamily) values.family = style.fontFamily;\n        if (style.fontWeight) values.weight = style.fontWeight;\n        if (style.fontStyle) values.style = style.fontStyle;\n      }\n\n      if (values.fontfamily) values.family = values.fontfamily;\n      if (values.fontweight) values.weight = values.fontweight;\n      if (values.fontstyle) values.style = values.fontstyle;\n\n      if (values.weight && values.weight.match(/^\\d+$/)) {\n        values.weight = parseInt(values.weight) > 600 ? 'bold' : 'normal';\n      }\n\n      if (values.family) {\n        variant = this.explicitVariant(values.family, values.weight, values.style);\n      } else {\n        if (this.node.getProperty('variantForm')) variant = '-tex-variant';\n        variant = (CommonWrapper.BOLDVARIANTS[values.weight] || {})[variant] || variant;\n        variant = (CommonWrapper.ITALICVARIANTS[values.style] || {})[variant] || variant;\n      }\n    }\n\n    this.variant = variant;\n  };\n\n  CommonWrapper.prototype.explicitVariant = function (fontFamily, fontWeight, fontStyle) {\n    var style = this.styles;\n    if (!style) style = this.styles = new Styles_js_1.Styles();\n    style.set('fontFamily', fontFamily);\n    if (fontWeight) style.set('fontWeight', fontWeight);\n    if (fontStyle) style.set('fontStyle', fontStyle);\n    return '-explicitFont';\n  };\n\n  CommonWrapper.prototype.getScale = function () {\n    var scale = 1,\n        parent = this.parent;\n    var pscale = parent ? parent.bbox.scale : 1;\n    var attributes = this.node.attributes;\n    var scriptlevel = Math.min(attributes.get('scriptlevel'), 2);\n    var fontsize = attributes.get('fontsize');\n    var mathsize = this.node.isToken || this.node.isKind('mstyle') ? attributes.get('mathsize') : attributes.getInherited('mathsize');\n\n    if (scriptlevel !== 0) {\n      scale = Math.pow(attributes.get('scriptsizemultiplier'), scriptlevel);\n      var scriptminsize = this.length2em(attributes.get('scriptminsize'), .8, 1);\n      if (scale < scriptminsize) scale = scriptminsize;\n    }\n\n    if (this.removedStyles && this.removedStyles.fontSize && !fontsize) {\n      fontsize = this.removedStyles.fontSize;\n    }\n\n    if (fontsize && !attributes.getExplicit('mathsize')) {\n      mathsize = fontsize;\n    }\n\n    if (mathsize !== '1') {\n      scale *= this.length2em(mathsize, 1, 1);\n    }\n\n    this.bbox.scale = scale;\n    this.bbox.rscale = scale / pscale;\n  };\n\n  CommonWrapper.prototype.getSpace = function () {\n    var isTop = this.isTopEmbellished();\n    var hasSpacing = this.node.hasSpacingAttributes();\n\n    if (this.jax.options.mathmlSpacing || hasSpacing) {\n      isTop && this.getMathMLSpacing();\n    } else {\n      this.getTeXSpacing(isTop, hasSpacing);\n    }\n  };\n\n  CommonWrapper.prototype.getMathMLSpacing = function () {\n    var node = this.node.coreMO();\n    var child = node.coreParent();\n    var parent = child.parent;\n    if (!parent || !parent.isKind('mrow') || parent.childNodes.length === 1) return;\n    var attributes = node.attributes;\n    var isScript = attributes.get('scriptlevel') > 0;\n    this.bbox.L = attributes.isSet('lspace') ? Math.max(0, this.length2em(attributes.get('lspace'))) : MathMLSpace(isScript, node.lspace);\n    this.bbox.R = attributes.isSet('rspace') ? Math.max(0, this.length2em(attributes.get('rspace'))) : MathMLSpace(isScript, node.rspace);\n    var n = parent.childIndex(child);\n    if (n === 0) return;\n    var prev = parent.childNodes[n - 1];\n    if (!prev.isEmbellished) return;\n    var bbox = this.jax.nodeMap.get(prev).getBBox();\n\n    if (bbox.R) {\n      this.bbox.L = Math.max(0, this.bbox.L - bbox.R);\n    }\n  };\n\n  CommonWrapper.prototype.getTeXSpacing = function (isTop, hasSpacing) {\n    if (!hasSpacing) {\n      var space = this.node.texSpacing();\n\n      if (space) {\n        this.bbox.L = this.length2em(space);\n      }\n    }\n\n    if (isTop || hasSpacing) {\n      var attributes = this.node.coreMO().attributes;\n\n      if (attributes.isSet('lspace')) {\n        this.bbox.L = Math.max(0, this.length2em(attributes.get('lspace')));\n      }\n\n      if (attributes.isSet('rspace')) {\n        this.bbox.R = Math.max(0, this.length2em(attributes.get('rspace')));\n      }\n    }\n  };\n\n  CommonWrapper.prototype.isTopEmbellished = function () {\n    return this.node.isEmbellished && !(this.node.parent && this.node.parent.isEmbellished);\n  };\n\n  CommonWrapper.prototype.core = function () {\n    return this.jax.nodeMap.get(this.node.core());\n  };\n\n  CommonWrapper.prototype.coreMO = function () {\n    return this.jax.nodeMap.get(this.node.coreMO());\n  };\n\n  CommonWrapper.prototype.getText = function () {\n    var e_3, _a;\n\n    var text = '';\n\n    if (this.node.isToken) {\n      try {\n        for (var _b = __values(this.node.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n\n          if (child instanceof MmlNode_js_1.TextNode) {\n            text += child.getText();\n          }\n        }\n      } catch (e_3_1) {\n        e_3 = {\n          error: e_3_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_3) throw e_3.error;\n        }\n      }\n    }\n\n    return text;\n  };\n\n  CommonWrapper.prototype.canStretch = function (direction) {\n    this.stretch = FontData_js_1.NOSTRETCH;\n\n    if (this.node.isEmbellished) {\n      var core = this.core();\n\n      if (core && core.node !== this.node) {\n        if (core.canStretch(direction)) {\n          this.stretch = core.stretch;\n        }\n      }\n    }\n\n    return this.stretch.dir !== 0;\n  };\n\n  CommonWrapper.prototype.getAlignShift = function () {\n    var _a;\n\n    var _b = (_a = this.node.attributes).getList.apply(_a, __spreadArray([], __read(MmlNode_js_1.indentAttributes))),\n        indentalign = _b.indentalign,\n        indentshift = _b.indentshift,\n        indentalignfirst = _b.indentalignfirst,\n        indentshiftfirst = _b.indentshiftfirst;\n\n    if (indentalignfirst !== 'indentalign') {\n      indentalign = indentalignfirst;\n    }\n\n    if (indentalign === 'auto') {\n      indentalign = this.jax.options.displayAlign;\n    }\n\n    if (indentshiftfirst !== 'indentshift') {\n      indentshift = indentshiftfirst;\n    }\n\n    if (indentshift === 'auto') {\n      indentshift = this.jax.options.displayIndent;\n\n      if (indentalign === 'right' && !indentshift.match(/^\\s*0[a-z]*\\s*$/)) {\n        indentshift = ('-' + indentshift.trim()).replace(/^--/, '');\n      }\n    }\n\n    var shift = this.length2em(indentshift, this.metrics.containerWidth);\n    return [indentalign, shift];\n  };\n\n  CommonWrapper.prototype.getAlignX = function (W, bbox, align) {\n    return align === 'right' ? W - (bbox.w + bbox.R) * bbox.rscale : align === 'left' ? bbox.L * bbox.rscale : (W - bbox.w * bbox.rscale) / 2;\n  };\n\n  CommonWrapper.prototype.getAlignY = function (H, D, h, d, align) {\n    return align === 'top' ? H - h : align === 'bottom' ? d - D : align === 'center' ? (H - h - (D - d)) / 2 : 0;\n  };\n\n  CommonWrapper.prototype.getWrapWidth = function (i) {\n    return this.childNodes[i].getBBox().w;\n  };\n\n  CommonWrapper.prototype.getChildAlign = function (_i) {\n    return 'left';\n  };\n\n  CommonWrapper.prototype.percent = function (m) {\n    return LENGTHS.percent(m);\n  };\n\n  CommonWrapper.prototype.em = function (m) {\n    return LENGTHS.em(m);\n  };\n\n  CommonWrapper.prototype.px = function (m, M) {\n    if (M === void 0) {\n      M = -LENGTHS.BIGDIMEN;\n    }\n\n    return LENGTHS.px(m, M, this.metrics.em);\n  };\n\n  CommonWrapper.prototype.length2em = function (length, size, scale) {\n    if (size === void 0) {\n      size = 1;\n    }\n\n    if (scale === void 0) {\n      scale = null;\n    }\n\n    if (scale === null) {\n      scale = this.bbox.scale;\n    }\n\n    return LENGTHS.length2em(length, size, scale, this.jax.pxPerEm);\n  };\n\n  CommonWrapper.prototype.unicodeChars = function (text, name) {\n    if (name === void 0) {\n      name = this.variant;\n    }\n\n    var chars = string_js_1.unicodeChars(text);\n    var variant = this.font.getVariant(name);\n\n    if (variant && variant.chars) {\n      var map_1 = variant.chars;\n      chars = chars.map(function (n) {\n        return ((map_1[n] || [])[3] || {}).smp || n;\n      });\n    }\n\n    return chars;\n  };\n\n  CommonWrapper.prototype.remapChars = function (chars) {\n    return chars;\n  };\n\n  CommonWrapper.prototype.mmlText = function (text) {\n    return this.node.factory.create('text').setText(text);\n  };\n\n  CommonWrapper.prototype.mmlNode = function (kind, properties, children) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    if (children === void 0) {\n      children = [];\n    }\n\n    return this.node.factory.create(kind, properties, children);\n  };\n\n  CommonWrapper.prototype.createMo = function (text) {\n    var mmlFactory = this.node.factory;\n    var textNode = mmlFactory.create('text').setText(text);\n    var mml = mmlFactory.create('mo', {\n      stretchy: true\n    }, [textNode]);\n    mml.inheritAttributesFrom(this.node);\n    var node = this.wrap(mml);\n    node.parent = this;\n    return node;\n  };\n\n  CommonWrapper.prototype.getVariantChar = function (variant, n) {\n    var char = this.font.getChar(variant, n) || [0, 0, 0, {\n      unknown: true\n    }];\n\n    if (char.length === 3) {\n      char[3] = {};\n    }\n\n    return char;\n  };\n\n  CommonWrapper.kind = 'unknown';\n  CommonWrapper.styles = {};\n  CommonWrapper.removeStyles = ['fontSize', 'fontFamily', 'fontWeight', 'fontStyle', 'fontVariant', 'font'];\n  CommonWrapper.skipAttributes = {\n    fontfamily: true,\n    fontsize: true,\n    fontweight: true,\n    fontstyle: true,\n    color: true,\n    background: true,\n    'class': true,\n    href: true,\n    style: true,\n    xmlns: true\n  };\n  CommonWrapper.BOLDVARIANTS = {\n    bold: {\n      normal: 'bold',\n      italic: 'bold-italic',\n      fraktur: 'bold-fraktur',\n      script: 'bold-script',\n      'sans-serif': 'bold-sans-serif',\n      'sans-serif-italic': 'sans-serif-bold-italic'\n    },\n    normal: {\n      bold: 'normal',\n      'bold-italic': 'italic',\n      'bold-fraktur': 'fraktur',\n      'bold-script': 'script',\n      'bold-sans-serif': 'sans-serif',\n      'sans-serif-bold-italic': 'sans-serif-italic'\n    }\n  };\n  CommonWrapper.ITALICVARIANTS = {\n    italic: {\n      normal: 'italic',\n      bold: 'bold-italic',\n      'sans-serif': 'sans-serif-italic',\n      'bold-sans-serif': 'sans-serif-bold-italic'\n    },\n    normal: {\n      italic: 'normal',\n      'bold-italic': 'bold',\n      'sans-serif-italic': 'sans-serif',\n      'sans-serif-bold-italic': 'bold-sans-serif'\n    }\n  };\n  return CommonWrapper;\n}(Wrapper_js_1.AbstractWrapper);\n\nexports.CommonWrapper = CommonWrapper;","map":{"version":3,"mappings":"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","names":["SMALLSIZE","MathMLSpace","script","size","__extends","factory","node","parent","_super","_this","FontData_js_1","font","jax","bbox","BBox_js_1","zero","getStyles","getVariant","getScale","getSpace","childNodes","map","child","wrapped","wrap","pwidth","notParent","isKind","fullWidth","Object","CommonWrapper","adaptor","math","metrics","isToken","push","nodeMap","set","save","bboxComputed","computeBBox","recompute","empty","_c","append","getBBox","clean","fixesPWidth","setChildPWidths","w","clear","changed","cbox","invalidateBBox","first","sk","dx","last","length","ic","styleString","attributes","getExplicit","style","styles","Styles_js_1","i","m","removeStyles","id","get","removedStyles","variant","values","getList","fontFamily","family","fontWeight","weight","fontStyle","fontfamily","fontweight","fontstyle","match","parseInt","explicitVariant","getProperty","BOLDVARIANTS","ITALICVARIANTS","scale","pscale","scriptlevel","Math","min","fontsize","mathsize","getInherited","pow","scriptminsize","length2em","fontSize","rscale","isTop","isTopEmbellished","hasSpacing","hasSpacingAttributes","options","mathmlSpacing","getMathMLSpacing","getTeXSpacing","coreMO","coreParent","isScript","L","isSet","max","lspace","R","rspace","n","childIndex","prev","isEmbellished","space","texSpacing","core","text","MmlNode_js_1","getText","direction","stretch","canStretch","dir","apply","_a","__spreadArray","indentalign","indentshift","indentalignfirst","indentshiftfirst","displayAlign","displayIndent","trim","replace","shift","containerWidth","W","align","H","D","h","d","_i","LENGTHS","percent","em","M","BIGDIMEN","px","pxPerEm","name","chars","string_js_1","map_1","smp","create","setText","kind","properties","children","mmlFactory","textNode","mml","stretchy","inheritAttributesFrom","char","getChar","unknown","color","background","href","xmlns","bold","normal","italic","fraktur","Wrapper_js_1","exports"],"sources":["/home/kinzoku99/Desktop/ProjectIO/frontend/node_modules/mathjax-full/ts/output/common/Wrapper.ts"],"sourcesContent":["/*************************************************************\n *\n *  Copyright (c) 2017-2021 The MathJax Consortium\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n\n/**\n * @fileoverview  Implements the CommonWrapper class\n *\n * @author dpvc@mathjax.org (Davide Cervone)\n */\n\nimport {AbstractWrapper, WrapperClass} from '../../core/Tree/Wrapper.js';\nimport {PropertyList} from '../../core/Tree/Node.js';\nimport {MmlNode, TextNode, AbstractMmlNode, indentAttributes} from '../../core/MmlTree/MmlNode.js';\nimport {MmlMo} from '../../core/MmlTree/MmlNodes/mo.js';\nimport {Property} from '../../core/Tree/Node.js';\nimport {unicodeChars} from '../../util/string.js';\nimport * as LENGTHS from '../../util/lengths.js';\nimport {Styles} from '../../util/Styles.js';\nimport {StyleList} from '../../util/StyleList.js';\nimport {CommonOutputJax} from './OutputJax.js';\nimport {CommonWrapperFactory} from './WrapperFactory.js';\nimport {BBox} from '../../util/BBox.js';\nimport {FontData, DelimiterData, CharData, CharOptions, DIRECTION, NOSTRETCH} from './FontData.js';\n\n/*****************************************************************/\n\n/**\n * Shorthand for a dictionary object (an object of key:value pairs)\n */\nexport type StringMap = {[key: string]: string};\n\n/**\n * MathML spacing rules\n */\n/* tslint:disable-next-line:whitespace */\nconst SMALLSIZE = 2/18;\n\n/**\n * @param {boolean} script   The scriptlevel\n * @param {number} size      The space size\n * @return {number}          The size clamped to SMALLSIZE when scriptlevel > 0\n */\nfunction MathMLSpace(script: boolean, size: number): number {\n  return (script ? size < SMALLSIZE ? 0 : SMALLSIZE : size);\n}\n\nexport type Constructor<T> = new(...args: any[]) => T;\n\n/**\n * Shorthands for wrappers and their constructors\n */\nexport type AnyWrapper = CommonWrapper<any, any, any, any, any, any>;\nexport type AnyWrapperClass = CommonWrapperClass<any, any, any, any, any, any>;\nexport type WrapperConstructor = Constructor<AnyWrapper>;\n\n/*********************************************************/\n/**\n *  The CommonWrapper class interface\n *\n * @template J  The OutputJax type\n * @template W  The Wrapper type\n * @template C  The WrapperClass type\n * @template CC The CharOptions type\n * @template FD The FontData type\n */\nexport interface CommonWrapperClass<\n  J extends CommonOutputJax<any, any, any, W, CommonWrapperFactory<J, W, C, CC, DD, FD>, FD, any>,\n  W extends CommonWrapper<J, W, C, CC, DD, FD>,\n  C extends CommonWrapperClass<J, W, C, CC, DD, FD>,\n  CC extends CharOptions,\n  DD extends DelimiterData,\n  FD extends FontData<CC, any, DD>\n> extends WrapperClass<MmlNode, CommonWrapper<J, W, C, CC, DD, FD>> {\n  /**\n   * @override\n   */\n  new(factory: CommonWrapperFactory<J, W, C, CC, DD, FD>, node: MmlNode, ...args: any[]): W;\n}\n\n/*****************************************************************/\n/**\n *  The base CommonWrapper class\n *\n * @template J  The OutputJax type\n * @template W  The Wrapper type\n * @template C  The WrapperClass type\n * @template CC The CharOptions type\n * @template FD The FontData type\n */\nexport class CommonWrapper<\n  J extends CommonOutputJax<any, any, any, W, CommonWrapperFactory<J, W, C, CC, DD, FD>, FD, any>,\n  W extends CommonWrapper<J, W, C, CC, DD, FD>,\n  C extends CommonWrapperClass<J, W, C, CC, DD, FD>,\n  CC extends CharOptions,\n  DD extends DelimiterData,\n  FD extends FontData<CC, any, DD>\n> extends AbstractWrapper<MmlNode, CommonWrapper<J, W, C, CC, DD, FD>> {\n\n  /**\n   * The wrapper kind\n   */\n  public static kind: string = 'unknown';\n\n  /**\n   * Any styles needed for the class\n   */\n  public static styles: StyleList = {};\n\n  /**\n   * Styles that should not be passed on from style attribute\n   */\n  public static removeStyles: string[] = [\n    'fontSize', 'fontFamily', 'fontWeight',\n    'fontStyle', 'fontVariant', 'font'\n  ];\n\n  /**\n   * Non-MathML attributes on MathML elements NOT to be copied to the\n   * corresponding DOM elements.  If set to false, then the attribute\n   * WILL be copied.  Most of these (like the font attributes) are handled\n   * in other ways.\n   */\n  public static skipAttributes: {[name: string]: boolean} = {\n    fontfamily: true, fontsize: true, fontweight: true, fontstyle: true,\n    color: true, background: true,\n    'class': true, href: true, style: true,\n    xmlns: true\n  };\n\n  /**\n   * The translation of mathvariant to bold styles, or to remove\n   * bold from a mathvariant.\n   */\n  public static BOLDVARIANTS: {[name: string]: StringMap} =  {\n    bold: {\n      normal: 'bold',\n      italic: 'bold-italic',\n      fraktur: 'bold-fraktur',\n      script: 'bold-script',\n      'sans-serif': 'bold-sans-serif',\n      'sans-serif-italic': 'sans-serif-bold-italic'\n    },\n    normal: {\n      bold: 'normal',\n      'bold-italic': 'italic',\n      'bold-fraktur': 'fraktur',\n      'bold-script': 'script',\n      'bold-sans-serif': 'sans-serif',\n      'sans-serif-bold-italic': 'sans-serif-italic'\n    }\n  };\n\n  /**\n   * The translation of mathvariant to italic styles, or to remove\n   * italic from a mathvariant.\n   */\n  public static ITALICVARIANTS: {[name: string]: StringMap} = {\n    italic: {\n      normal: 'italic',\n      bold: 'bold-italic',\n      'sans-serif': 'sans-serif-italic',\n      'bold-sans-serif': 'sans-serif-bold-italic'\n    },\n    normal: {\n      italic: 'normal',\n      'bold-italic': 'bold',\n      'sans-serif-italic': 'sans-serif',\n      'sans-serif-bold-italic': 'bold-sans-serif'\n    }\n  };\n\n  /**\n   * The factory used to create more wrappers\n   */\n  protected factory: CommonWrapperFactory<J, W, C, CC, DD, FD>;\n\n  /**\n   * The parent of this node\n   */\n  public parent: W = null;\n\n  /**\n   * The children of this node\n   */\n  public childNodes: W[];\n\n  /**\n   * Styles that must be handled directly by the wrappers (mostly having to do with fonts)\n   */\n  protected removedStyles: StringMap = null;\n\n  /**\n   * The explicit styles set by the node\n   */\n  protected styles: Styles = null;\n\n  /**\n   * The mathvariant for this node\n   */\n  public variant: string = '';\n\n  /**\n   * The bounding box for this node\n   */\n  public bbox: BBox;\n  /**\n   * Whether the bounding box has been computed yet\n   */\n  protected bboxComputed: boolean = false;\n\n  /**\n   * Delimiter data for stretching this node (NOSTRETCH means not yet determined)\n   */\n  public stretch: DD = NOSTRETCH as DD;\n\n  /**\n   * Easy access to the font parameters\n   */\n  public font: FD = null;\n\n  /**\n   * Easy access to the output jax for this node\n   */\n  get jax() {\n    return this.factory.jax;\n  }\n\n  /**\n   * Easy access to the DOMAdaptor object\n   */\n  get adaptor() {\n    return this.factory.jax.adaptor;\n  }\n\n  /**\n   * Easy access to the metric data for this node\n   */\n  get metrics() {\n    return this.factory.jax.math.metrics;\n  }\n\n  /**\n   * True if children with percentage widths should be resolved by this container\n   */\n  get fixesPWidth() {\n    return !this.node.notParent && !this.node.isToken;\n  }\n\n  /*******************************************************************/\n\n  /**\n   * @override\n   */\n  constructor(factory: CommonWrapperFactory<J, W, C, CC, DD, FD>, node: MmlNode, parent: W = null) {\n    super(factory, node);\n    this.parent = parent;\n    this.font = factory.jax.font;\n    this.bbox = BBox.zero();\n    this.getStyles();\n    this.getVariant();\n    this.getScale();\n    this.getSpace();\n    this.childNodes = node.childNodes.map((child: MmlNode) => {\n      const wrapped = this.wrap(child);\n      if (wrapped.bbox.pwidth && (node.notParent || node.isKind('math'))) {\n        this.bbox.pwidth = BBox.fullWidth;\n      }\n      return wrapped;\n    });\n  }\n\n  /**\n   * @param {MmlNode} node  The node to the wrapped\n   * @param {W} parent  The wrapped parent node\n   * @return {W}  The newly wrapped node\n   */\n  public wrap(node: MmlNode, parent: W = null): W {\n    const wrapped = this.factory.wrap(node, parent || this);\n    if (parent) {\n      parent.childNodes.push(wrapped);\n    }\n    this.jax.nodeMap.set(node, wrapped);\n    return wrapped;\n  }\n\n  /*******************************************************************/\n  /**\n   * Return the wrapped node's bounding box, either the cached one, if it exists,\n   *   or computed directly if not.\n   *\n   * @param {boolean} save  Whether to cache the bbox or not (used for stretchy elements)\n   * @return {BBox}  The computed bounding box\n   */\n  public getBBox(save: boolean = true): BBox {\n    if (this.bboxComputed) {\n      return this.bbox;\n    }\n    const bbox = (save ? this.bbox : BBox.zero());\n    this.computeBBox(bbox);\n    this.bboxComputed = save;\n    return bbox;\n  }\n\n  /**\n   * @param {BBox} bbox           The bounding box to modify (either this.bbox, or an empty one)\n   * @param {boolean} recompute   True if we are recomputing due to changes in children that have percentage widths\n   */\n  protected computeBBox(bbox: BBox, recompute: boolean = false) {\n    bbox.empty();\n    for (const child of this.childNodes) {\n      bbox.append(child.getBBox());\n    }\n    bbox.clean();\n    if (this.fixesPWidth && this.setChildPWidths(recompute)) {\n      this.computeBBox(bbox, true);\n    }\n  }\n\n  /**\n   * Recursively resolve any percentage widths in the child nodes using the given\n   *   container width (or the child width, if none was passed).\n   *   Overriden for mtables in order to compute the width.\n   *\n   * @param {boolean} recompute  True if we are recomputing due to changes in children\n   * @param {(number|null)=} w   The width of the container (from which percentages are computed)\n   * @param {boolean=} clear     True if pwidth marker is to be cleared\n   * @return {boolean}           True if a percentage width was found\n   */\n  public setChildPWidths(recompute: boolean, w: (number | null) = null, clear: boolean = true): boolean {\n    if (recompute) {\n      return false;\n    }\n    if (clear) {\n      this.bbox.pwidth = '';\n    }\n    let changed = false;\n    for (const child of this.childNodes) {\n      const cbox = child.getBBox();\n      if (cbox.pwidth && child.setChildPWidths(recompute, w === null ? cbox.w : w, clear)) {\n        changed = true;\n      }\n    }\n    return changed;\n  }\n\n  /**\n   * Mark BBox to be computed again (e.g., when an mo has stretched)\n   */\n  public invalidateBBox() {\n    if (this.bboxComputed) {\n      this.bboxComputed = false;\n      if (this.parent) {\n        this.parent.invalidateBBox();\n      }\n    }\n  }\n\n  /**\n   * Copy child skew and italic correction\n   *\n   * @param {BBox} bbox  The bounding box to modify\n   */\n  protected copySkewIC(bbox: BBox) {\n    const first = this.childNodes[0];\n    if (first?.bbox.sk) {\n      bbox.sk = first.bbox.sk;\n    }\n    if (first?.bbox.dx) {\n      bbox.dx = first.bbox.dx;\n    }\n    const last = this.childNodes[this.childNodes.length - 1];\n    if (last?.bbox.ic) {\n      bbox.ic = last.bbox.ic;\n      bbox.w += bbox.ic;\n    }\n  }\n\n  /*******************************************************************/\n\n  /**\n   * Add the style attribute, but remove any font-related styles\n   *   (since these are handled separately by the variant)\n   */\n  protected getStyles() {\n    const styleString = this.node.attributes.getExplicit('style') as string;\n    if (!styleString) return;\n    const style = this.styles = new Styles(styleString);\n    for (let i = 0, m = CommonWrapper.removeStyles.length; i < m; i++) {\n      const id = CommonWrapper.removeStyles[i];\n      if (style.get(id)) {\n        if (!this.removedStyles) this.removedStyles = {};\n        this.removedStyles[id] = style.get(id);\n        style.set(id, '');\n      }\n    }\n  }\n\n  /**\n   * Get the mathvariant (or construct one, if needed).\n   */\n  protected getVariant() {\n    if (!this.node.isToken) return;\n    const attributes = this.node.attributes;\n    let variant = attributes.get('mathvariant') as string;\n    if (!attributes.getExplicit('mathvariant')) {\n      const values = attributes.getList('fontfamily', 'fontweight', 'fontstyle') as StringMap;\n      if (this.removedStyles) {\n        const style = this.removedStyles;\n        if (style.fontFamily) values.family = style.fontFamily;\n        if (style.fontWeight) values.weight = style.fontWeight;\n        if (style.fontStyle)  values.style  = style.fontStyle;\n      }\n      if (values.fontfamily) values.family = values.fontfamily;\n      if (values.fontweight) values.weight = values.fontweight;\n      if (values.fontstyle)  values.style  = values.fontstyle;\n      if (values.weight && values.weight.match(/^\\d+$/)) {\n        values.weight = (parseInt(values.weight) > 600 ? 'bold' : 'normal');\n      }\n      if (values.family) {\n        variant = this.explicitVariant(values.family, values.weight, values.style);\n      } else {\n        if (this.node.getProperty('variantForm')) variant = '-tex-variant';\n        variant = (CommonWrapper.BOLDVARIANTS[values.weight] || {})[variant] || variant;\n        variant = (CommonWrapper.ITALICVARIANTS[values.style] || {})[variant] || variant;\n      }\n    }\n    this.variant = variant;\n  }\n\n  /**\n   * Set the CSS for a token element having an explicit font (rather than regular mathvariant).\n   *\n   * @param {string} fontFamily  The font family to use\n   * @param {string} fontWeight  The font weight to use\n   * @param {string} fontStyle   The font style to use\n   */\n  protected explicitVariant(fontFamily: string, fontWeight: string, fontStyle: string) {\n    let style = this.styles;\n    if (!style) style = this.styles = new Styles();\n    style.set('fontFamily', fontFamily);\n    if (fontWeight) style.set('fontWeight', fontWeight);\n    if (fontStyle)  style.set('fontStyle', fontStyle);\n    return '-explicitFont';\n  }\n\n  /**\n   * Determine the scaling factor to use for this wrapped node, and set the styles for it.\n   */\n  protected getScale() {\n    let scale = 1, parent = this.parent;\n    let pscale = (parent ? parent.bbox.scale : 1);\n    let attributes = this.node.attributes;\n    let scriptlevel = Math.min(attributes.get('scriptlevel') as number, 2);\n    let fontsize = attributes.get('fontsize');\n    let mathsize = (this.node.isToken || this.node.isKind('mstyle') ?\n                    attributes.get('mathsize') : attributes.getInherited('mathsize'));\n    //\n    // If scriptsize is non-zero, set scale based on scriptsizemultiplier\n    //\n    if (scriptlevel !== 0) {\n      scale = Math.pow(attributes.get('scriptsizemultiplier') as number, scriptlevel);\n      let scriptminsize = this.length2em(attributes.get('scriptminsize'), .8, 1);\n      if (scale < scriptminsize) scale = scriptminsize;\n    }\n    //\n    // If there is style=\"font-size:...\", and not fontsize attribute, use that as fontsize\n    //\n    if (this.removedStyles && this.removedStyles.fontSize && !fontsize) {\n      fontsize = this.removedStyles.fontSize;\n    }\n    //\n    // If there is a fontsize and no mathsize attribute, is that\n    //\n    if (fontsize && !attributes.getExplicit('mathsize')) {\n      mathsize = fontsize;\n    }\n    //\n    //  Incorporate the mathsize, if any\n    //\n    if (mathsize !== '1') {\n      scale *= this.length2em(mathsize, 1, 1);\n    }\n    //\n    // Record the scaling factors and set the element's CSS\n    //\n    this.bbox.scale = scale;\n    this.bbox.rscale = scale / pscale;\n  }\n\n  /**\n   * Sets the spacing based on TeX or MathML algorithm\n   */\n  protected getSpace() {\n    const isTop = this.isTopEmbellished();\n    const hasSpacing = this.node.hasSpacingAttributes();\n    if (this.jax.options.mathmlSpacing || hasSpacing) {\n      isTop && this.getMathMLSpacing();\n    } else {\n      this.getTeXSpacing(isTop, hasSpacing);\n    }\n  }\n\n  /**\n   * Get the spacing using MathML rules based on the core MO\n   */\n  protected getMathMLSpacing() {\n    const node = this.node.coreMO() as MmlMo;\n    //\n    // If the mo is not within a multi-node mrow, don't add space\n    //\n    const child = node.coreParent();\n    const parent = child.parent;\n    if (!parent || !parent.isKind('mrow') || parent.childNodes.length === 1) return;\n    //\n    // Get the lspace and rspace\n    //\n    const attributes = node.attributes;\n    const isScript = (attributes.get('scriptlevel') > 0);\n    this.bbox.L = (attributes.isSet('lspace') ?\n                   Math.max(0, this.length2em(attributes.get('lspace'))) :\n                   MathMLSpace(isScript, node.lspace));\n    this.bbox.R = (attributes.isSet('rspace') ?\n                   Math.max(0, this.length2em(attributes.get('rspace'))) :\n                   MathMLSpace(isScript, node.rspace));\n    //\n    // If there are two adjacent <mo>, use enough left space to make it\n    //   the maximum of the rspace of the first and lspace of the second\n    //\n    const n = parent.childIndex(child);\n    if (n === 0) return;\n    const prev = parent.childNodes[n - 1] as AbstractMmlNode;\n    if (!prev.isEmbellished) return;\n    const bbox = this.jax.nodeMap.get(prev).getBBox();\n    if (bbox.R) {\n      this.bbox.L = Math.max(0, this.bbox.L - bbox.R);\n    }\n  }\n\n  /**\n   * Get the spacing using the TeX rules\n   *\n   * @parm {boolean} isTop       True when this is a top-level embellished operator\n   * @parm {boolean} hasSpacing  True when there is an explicit or inherited 'form' attribute\n   */\n  protected getTeXSpacing(isTop: boolean, hasSpacing: boolean) {\n    if (!hasSpacing) {\n      const space = this.node.texSpacing();\n      if (space) {\n        this.bbox.L = this.length2em(space);\n      }\n    }\n    if (isTop || hasSpacing) {\n      const attributes = this.node.coreMO().attributes;\n      if (attributes.isSet('lspace')) {\n        this.bbox.L = Math.max(0, this.length2em(attributes.get('lspace')));\n      }\n      if (attributes.isSet('rspace')) {\n        this.bbox.R = Math.max(0, this.length2em(attributes.get('rspace')));\n      }\n    }\n  }\n\n  /**\n   * @return {boolean}   True if this is the top-most container of an embellished operator that is\n   *                       itself an embellished operator (the maximal embellished operator for its core)\n   */\n  protected isTopEmbellished(): boolean {\n    return (this.node.isEmbellished &&\n            !(this.node.parent && this.node.parent.isEmbellished));\n  }\n\n  /*******************************************************************/\n\n  /**\n   * @return {CommonWrapper}  The wrapper for this node's core node\n   */\n  public core(): CommonWrapper<J, W, C, CC, DD, FD> {\n    return this.jax.nodeMap.get(this.node.core());\n  }\n\n  /**\n   * @return {CommonWrapper}  The wrapper for this node's core <mo> node\n   */\n  public coreMO(): CommonWrapper<J, W, C, CC, DD, FD> {\n    return this.jax.nodeMap.get(this.node.coreMO());\n  }\n\n  /**\n   * @return {string}  For a token node, the combined text content of the node's children\n   */\n  public getText(): string {\n    let text = '';\n    if (this.node.isToken) {\n      for (const child of this.node.childNodes) {\n        if (child instanceof TextNode) {\n          text += child.getText();\n        }\n      }\n    }\n    return text;\n  }\n\n  /**\n   * @param {DIRECTION} direction  The direction to stretch this node\n   * @return {boolean}             Whether the node can stretch in that direction\n   */\n  public canStretch(direction: DIRECTION): boolean {\n    this.stretch = NOSTRETCH as DD;\n    if (this.node.isEmbellished) {\n      let core = this.core();\n      if (core && core.node !== this.node) {\n        if (core.canStretch(direction)) {\n          this.stretch = core.stretch;\n        }\n      }\n    }\n    return this.stretch.dir !== DIRECTION.None;\n  }\n\n  /**\n   * @return {[string, number]}  The alignment and indentation shift for the expression\n   */\n  protected getAlignShift(): [string, number] {\n    let {indentalign, indentshift, indentalignfirst, indentshiftfirst} =\n      this.node.attributes.getList(...indentAttributes) as StringMap;\n    if (indentalignfirst !== 'indentalign') {\n      indentalign = indentalignfirst;\n    }\n    if (indentalign === 'auto') {\n      indentalign = this.jax.options.displayAlign;\n    }\n    if (indentshiftfirst !== 'indentshift') {\n      indentshift = indentshiftfirst;\n    }\n    if (indentshift === 'auto') {\n      indentshift = this.jax.options.displayIndent;\n      if (indentalign === 'right' && !indentshift.match(/^\\s*0[a-z]*\\s*$/)) {\n        indentshift = ('-' + indentshift.trim()).replace(/^--/, '');\n      }\n    }\n    const shift = this.length2em(indentshift, this.metrics.containerWidth);\n    return [indentalign, shift] as [string, number];\n  }\n\n  /**\n   * @param {number} W       The total width\n   * @param {BBox} bbox      The bbox to be aligned\n   * @param {string} align   How to align (left, center, right)\n   * @return {number}        The x position of the aligned width\n   */\n  protected getAlignX(W: number, bbox: BBox, align: string): number {\n    return (align === 'right' ? W - (bbox.w + bbox.R) * bbox.rscale :\n            align === 'left' ? bbox.L * bbox.rscale :\n            (W - bbox.w * bbox.rscale) / 2);\n  }\n\n  /**\n   * @param {number} H        The total height\n   * @param {number} D        The total depth\n   * @param {number} h        The height to be aligned\n   * @param {number} d        The depth to be aligned\n   * @param {string} align    How to align (top, bottom, center, axis, baseline)\n   * @return {number}         The y position of the aligned baseline\n   */\n  protected getAlignY(H: number, D: number, h: number, d: number, align: string): number {\n    return (align === 'top' ? H - h :\n            align === 'bottom' ? d - D :\n            align === 'center' ? ((H - h) - (D - d)) / 2 :\n            0); // baseline and axis\n  }\n\n  /**\n   * @param {number} i   The index of the child element whose container is needed\n   * @return {number}    The inner width as a container (for percentage widths)\n   */\n  public getWrapWidth(i: number): number {\n    return this.childNodes[i].getBBox().w;\n  }\n\n  /**\n   * @param {number} i   The index of the child element whose container is needed\n   * @return {string}    The alignment child element\n   */\n  public getChildAlign(_i: number): string {\n    return 'left';\n  }\n\n  /*******************************************************************/\n  /*\n   * Easy access to some utility routines\n   */\n\n  /**\n   * @param {number} m  A number to be shown as a percent\n   * @return {string}  The number m as a percent\n   */\n  protected percent(m: number): string {\n    return LENGTHS.percent(m);\n  }\n\n  /**\n   * @param {number} m  A number to be shown in ems\n   * @return {string}  The number with units of ems\n   */\n  protected em(m: number): string {\n    return LENGTHS.em(m);\n  }\n\n  /**\n   * @param {number} m   A number of em's to be shown as pixels\n   * @param {number} M   The minimum number of pixels to allow\n   * @return {string}  The number with units of px\n   */\n  protected px(m: number, M: number = -LENGTHS.BIGDIMEN): string {\n    return LENGTHS.px(m, M, this.metrics.em);\n  }\n\n  /**\n   * @param {Property} length  A dimension (giving number and units) or number to be converted to ems\n   * @param {number} size  The default size of the dimension (for percentage values)\n   * @param {number} scale  The current scaling factor (to handle absolute units)\n   * @return {number}  The dimension converted to ems\n   */\n  protected length2em(length: Property, size: number = 1, scale: number = null): number {\n    if (scale === null) {\n      scale = this.bbox.scale;\n    }\n    return LENGTHS.length2em(length as string, size, scale, this.jax.pxPerEm);\n  }\n\n  /**\n   * @param {string} text   The text to turn into unicode locations\n   * @param {string} name   The name of the variant for the characters\n   * @return {number[]}     Array of numbers represeting the string's unicode character positions\n   */\n  protected unicodeChars(text: string, name: string = this.variant): number[] {\n    let chars = unicodeChars(text);\n    //\n    //  Remap to Math Alphanumerics block\n    //\n    const variant = this.font.getVariant(name);\n    if (variant && variant.chars) {\n      const map = variant.chars;\n      //\n      //  Is map[n] doesn't exist, (map[n] || []) still gives an CharData array.\n      //  If the array doesn't have a CharOptions element use {} instead.\n      //  Then check if the options has an smp property, which gives\n      //    the Math Alphabet mapping for this character.\n      //  Otherwise use the original code point, n.\n      //\n      chars = chars.map((n) => ((map[n] || [])[3] || {}).smp || n);\n    }\n    return chars;\n  }\n\n  /**\n   * @param {number[]} chars    The array of unicode character numbers to remap\n   * @return {number[]}         The converted array\n   */\n  public remapChars(chars: number[]): number[] {\n    return chars;\n  }\n\n  /**\n   * @param {string} text   The text from which to create a TextNode object\n   * @return {TextNode}     The TextNode with the given text\n   */\n  public mmlText(text: string): TextNode {\n    return ((this.node as AbstractMmlNode).factory.create('text') as TextNode).setText(text);\n  }\n\n  /**\n   * @param {string} kind             The kind of MmlNode to create\n   * @param {ProperyList} properties  The properties to set initially\n   * @param {MmlNode[]} children      The child nodes to add to the created node\n   * @return {MmlNode}                The newly created MmlNode\n   */\n  public mmlNode(kind: string, properties: PropertyList = {}, children: MmlNode[] = []): MmlNode {\n    return (this.node as AbstractMmlNode).factory.create(kind, properties, children);\n  }\n\n  /**\n   * Create an mo wrapper with the given text,\n   *   link it in, and give it the right defaults.\n   *\n   * @param {string} text     The text for the wrapped element\n   * @return {CommonWrapper}  The wrapped MmlMo node\n   */\n  protected createMo(text: string): CommonWrapper<J, W, C, CC, DD, FD> {\n    const mmlFactory = (this.node as AbstractMmlNode).factory;\n    const textNode = (mmlFactory.create('text') as TextNode).setText(text);\n    const mml = mmlFactory.create('mo', {stretchy: true}, [textNode]);\n    mml.inheritAttributesFrom(this.node);\n    const node = this.wrap(mml);\n    node.parent = this as any as W;\n    return node;\n  }\n\n  /**\n   * @param {string} variant   The variant in which to look for the character\n   * @param {number} n         The number of the character to look up\n   * @return {CharData}        The full CharData object, with CharOptions guaranteed to be defined\n   */\n  protected getVariantChar(variant: string, n: number): CharData<CC> {\n    const char = this.font.getChar(variant, n) || [0, 0, 0, {unknown: true} as CC];\n    if (char.length === 3) {\n      (char as any)[3] = {};\n    }\n    return char as [number, number, number, CC];\n  }\n\n}\n"]},"metadata":{},"sourceType":"script"}