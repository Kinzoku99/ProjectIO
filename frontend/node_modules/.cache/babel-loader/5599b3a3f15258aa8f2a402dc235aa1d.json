{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMmultiscriptsMixin = exports.ScriptNames = exports.NextScript = void 0;\n\nvar BBox_js_1 = require(\"../../../util/BBox.js\");\n\nexports.NextScript = {\n  base: 'subList',\n  subList: 'supList',\n  supList: 'subList',\n  psubList: 'psupList',\n  psupList: 'psubList'\n};\nexports.ScriptNames = ['sup', 'sup', 'psup', 'psub'];\n\nfunction CommonMmultiscriptsMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n\n      _this.scriptData = null;\n      _this.firstPrescript = 0;\n\n      _this.getScriptData();\n\n      return _this;\n    }\n\n    class_1.prototype.combinePrePost = function (pre, post) {\n      var bbox = new BBox_js_1.BBox(pre);\n      bbox.combine(post, 0, 0);\n      return bbox;\n    };\n\n    class_1.prototype.computeBBox = function (bbox, recompute) {\n      if (recompute === void 0) {\n        recompute = false;\n      }\n\n      var scriptspace = this.font.params.scriptspace;\n      var data = this.scriptData;\n      var sub = this.combinePrePost(data.sub, data.psub);\n      var sup = this.combinePrePost(data.sup, data.psup);\n\n      var _a = __read(this.getUVQ(sub, sup), 2),\n          u = _a[0],\n          v = _a[1];\n\n      bbox.empty();\n\n      if (data.numPrescripts) {\n        bbox.combine(data.psup, scriptspace, u);\n        bbox.combine(data.psub, scriptspace, v);\n      }\n\n      bbox.append(data.base);\n\n      if (data.numScripts) {\n        var w = bbox.w;\n        bbox.combine(data.sup, w, u);\n        bbox.combine(data.sub, w, v);\n        bbox.w += scriptspace;\n      }\n\n      bbox.clean();\n      this.setChildPWidths(recompute);\n    };\n\n    class_1.prototype.getScriptData = function () {\n      var data = this.scriptData = {\n        base: null,\n        sub: BBox_js_1.BBox.empty(),\n        sup: BBox_js_1.BBox.empty(),\n        psub: BBox_js_1.BBox.empty(),\n        psup: BBox_js_1.BBox.empty(),\n        numPrescripts: 0,\n        numScripts: 0\n      };\n      var lists = this.getScriptBBoxLists();\n      this.combineBBoxLists(data.sub, data.sup, lists.subList, lists.supList);\n      this.combineBBoxLists(data.psub, data.psup, lists.psubList, lists.psupList);\n      data.base = lists.base[0];\n      data.numPrescripts = lists.psubList.length;\n      data.numScripts = lists.subList.length;\n    };\n\n    class_1.prototype.getScriptBBoxLists = function () {\n      var e_1, _a;\n\n      var lists = {\n        base: [],\n        subList: [],\n        supList: [],\n        psubList: [],\n        psupList: []\n      };\n      var script = 'base';\n\n      try {\n        for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n\n          if (child.node.isKind('mprescripts')) {\n            script = 'psubList';\n          } else {\n            lists[script].push(child.getBBox());\n            script = exports.NextScript[script];\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n\n      this.firstPrescript = lists.subList.length + lists.supList.length + 2;\n      this.padLists(lists.subList, lists.supList);\n      this.padLists(lists.psubList, lists.psupList);\n      return lists;\n    };\n\n    class_1.prototype.padLists = function (list1, list2) {\n      if (list1.length > list2.length) {\n        list2.push(BBox_js_1.BBox.empty());\n      }\n    };\n\n    class_1.prototype.combineBBoxLists = function (bbox1, bbox2, list1, list2) {\n      for (var i = 0; i < list1.length; i++) {\n        var _a = __read(this.getScaledWHD(list1[i]), 3),\n            w1 = _a[0],\n            h1 = _a[1],\n            d1 = _a[2];\n\n        var _b = __read(this.getScaledWHD(list2[i]), 3),\n            w2 = _b[0],\n            h2 = _b[1],\n            d2 = _b[2];\n\n        var w = Math.max(w1, w2);\n        bbox1.w += w;\n        bbox2.w += w;\n        if (h1 > bbox1.h) bbox1.h = h1;\n        if (d1 > bbox1.d) bbox1.d = d1;\n        if (h2 > bbox2.h) bbox2.h = h2;\n        if (d2 > bbox2.d) bbox2.d = d2;\n      }\n    };\n\n    class_1.prototype.getScaledWHD = function (bbox) {\n      var w = bbox.w,\n          h = bbox.h,\n          d = bbox.d,\n          rscale = bbox.rscale;\n      return [w * rscale, h * rscale, d * rscale];\n    };\n\n    class_1.prototype.getUVQ = function (subbox, supbox) {\n      var _a;\n\n      if (!this.UVQ) {\n        var _b = __read([0, 0, 0], 3),\n            u = _b[0],\n            v = _b[1],\n            q = _b[2];\n\n        if (subbox.h === 0 && subbox.d === 0) {\n          u = this.getU();\n        } else if (supbox.h === 0 && supbox.d === 0) {\n          u = -this.getV();\n        } else {\n          _a = __read(_super.prototype.getUVQ.call(this, subbox, supbox), 3), u = _a[0], v = _a[1], q = _a[2];\n        }\n\n        this.UVQ = [u, v, q];\n      }\n\n      return this.UVQ;\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMmultiscriptsMixin = CommonMmultiscriptsMixin;","map":{"version":3,"mappings":"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","names":["exports","base","subList","supList","psubList","psupList","CommonMmultiscriptsMixin","Base","__extends","args","_this","getScriptData","class_1","pre","post","bbox","BBox_js_1","combine","recompute","scriptspace","font","params","data","scriptData","sub","combinePrePost","psub","sup","psup","getUVQ","u","v","empty","numPrescripts","append","numScripts","w","clean","setChildPWidths","lists","getScriptBBoxLists","combineBBoxLists","length","script","childNodes","_c","child","node","isKind","push","getBBox","firstPrescript","padLists","list1","list2","bbox1","bbox2","i","getScaledWHD","w1","h1","d1","w2","h2","d2","Math","max","h","d","rscale","subbox","supbox","UVQ","q","getU","getV","_a","_super","call"],"sources":["/home/kinzoku99/Desktop/ProjectIO/frontend/node_modules/mathjax-full/ts/output/common/Wrappers/mmultiscripts.ts"],"sourcesContent":["/*************************************************************\n *\n *  Copyright (c) 2018-2021 The MathJax Consortium\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n\n/**\n * @fileoverview  Implements the CommonMmultiscripts wrapper mixin for the MmlMmultiscripts object\n *\n * @author dpvc@mathjax.org (Davide Cervone)\n */\n\nimport {AnyWrapper, Constructor} from '../Wrapper.js';\nimport {CommonMsubsup, MsubsupConstructor} from './msubsup.js';\nimport {BBox} from '../../../util/BBox.js';\n\n/*****************************************************************/\n\n/**\n * The data about the scripts and base\n */\nexport type ScriptData = {\n  base: BBox;\n  sub: BBox;   // combined bbox for all subscripts\n  sup: BBox;   // combined bbox for all superscripts\n  psub: BBox;  // combined bbox for all presubscripts\n  psup: BBox;  // combined bbox for all presuperscripts\n  numPrescripts: number;\n  numScripts: number;\n};\nexport type ScriptDataName = keyof ScriptData;\n\n/**\n * The lists of all the individual script bboxes\n */\nexport type ScriptLists = {\n  base: BBox[];\n  subList: BBox[];\n  supList: BBox[];\n  psubList: BBox[];\n  psupList: BBox[];\n};\nexport type ScriptListName = keyof ScriptLists;\n\n/**\n * The type of script that follows the given type\n */\nexport const NextScript: {[key: string]: ScriptListName} = {\n  base: 'subList',\n  subList: 'supList',\n  supList: 'subList',\n  psubList: 'psupList',\n  psupList: 'psubList',\n};\n\n/**\n * The names of the scripts (for looping)\n */\nexport const ScriptNames = ['sup', 'sup', 'psup', 'psub'] as ScriptDataName[];\n\n/*****************************************************************/\n/**\n * The CommonMmultiscripts interface\n *\n * @template W  The child-node Wrapper class\n */\nexport interface CommonMmultiscripts<W extends AnyWrapper> extends CommonMsubsup<W> {\n\n  /**\n   *  The cached data for the various bounding boxes\n   */\n  scriptData: ScriptData;\n\n  /**\n   *  The index of the child following the <mprescripts/> tag\n   */\n  firstPrescript: number;\n\n  /**\n   * @param {BBox} pre   The prescript bounding box\n   * @param {BBox} post  The postcript bounding box\n   * @return {BBox}      The combined bounding box\n   */\n  combinePrePost(pre: BBox, post: BBox): BBox;\n\n  /**\n   * Compute the bounding box information about all the scripts\n   */\n  getScriptData(): void;\n\n  /**\n   * @return {ScriptLists}  The bounding boxes for all the scripts divided into lists by position\n   */\n  getScriptBBoxLists(): ScriptLists;\n\n  /**\n   * Pad the second list, if it is one short\n   *\n   * @param {BBox[]} list1   The first list\n   * @param {BBox[]} list2   The second list\n   */\n  padLists(list1: BBox[], list2: BBox[]): void;\n\n  /**\n   * @param {BBox} bbox1    The bbox for the combined subscripts\n   * @param {BBox} bbox2    The bbox for the combined superscripts\n   * @param {BBox[]} list1  The list of subscripts to combine\n   * @param {BBox[]} list2  The list of superscripts to combine\n   */\n  combineBBoxLists(bbox1: BBox, bbox2: BBox, list1: BBox[], list2: BBox[]): void;\n\n  /**\n   * @param {BBox} bbox  The bounding box from which to get the (scaled) width, height, and depth\n   */\n  getScaledWHD(bbox: BBox): void;\n\n}\n\n/**\n * Shorthand for the CommonMmultiscripts constructor\n *\n * @template W  The child-node Wrapper class\n */\nexport type MmultiscriptsConstructor<W extends AnyWrapper> = Constructor<CommonMmultiscripts<W>>;\n\n/*****************************************************************/\n/**\n * The CommonMmultiscripts wrapper mixin for the MmlMmultiscripts object\n *\n * @template W  The child-node Wrapper class\n * @template T  The Wrapper class constructor type\n */\nexport function CommonMmultiscriptsMixin<\n  W extends AnyWrapper,\n  T extends MsubsupConstructor<W>\n>(Base: T): MmultiscriptsConstructor<W> & T {\n\n  return class extends Base {\n\n    /**\n     *  The cached data for the various bounding boxes\n     */\n    public scriptData: ScriptData = null;\n\n    /**\n     *  The index of the child following the <mprescripts/> tag\n     */\n    public firstPrescript = 0;\n\n    /**\n     * @override\n     */\n    constructor(...args: any[]) {\n      super(...args);\n      this.getScriptData();\n    }\n\n    /*************************************************************/\n\n    /**\n     * @param {BBox} pre   The prescript bounding box\n     * @param {BBox} post  The postcript bounding box\n     * @return {BBox}      The combined bounding box\n     */\n    public combinePrePost(pre: BBox, post: BBox): BBox {\n      const bbox = new BBox(pre);\n      bbox.combine(post, 0, 0);\n      return bbox;\n    }\n\n    /*************************************************************/\n\n    /**\n     * @override\n     */\n    public computeBBox(bbox: BBox, recompute: boolean = false) {\n      //\n      // Get the bounding boxes, and combine the pre- and post-scripts\n      //  to get a common offset for both\n      //\n      const scriptspace = this.font.params.scriptspace;\n      const data = this.scriptData;\n      const sub = this.combinePrePost(data.sub, data.psub);\n      const sup = this.combinePrePost(data.sup, data.psup);\n      const [u, v] = this.getUVQ(sub, sup);\n      //\n      //  Lay out the pre-scripts, then the base, then the post-scripts\n      //\n      bbox.empty();\n      if (data.numPrescripts) {\n        bbox.combine(data.psup, scriptspace, u);\n        bbox.combine(data.psub, scriptspace, v);\n      }\n      bbox.append(data.base);\n      if (data.numScripts) {\n        const w = bbox.w;\n        bbox.combine(data.sup, w, u);\n        bbox.combine(data.sub, w, v);\n        bbox.w += scriptspace;\n      }\n      bbox.clean();\n      this.setChildPWidths(recompute);\n    }\n\n    /**\n     * Compute the bounding box information about all the scripts\n     */\n    public getScriptData() {\n      //\n      //  Initialize the bounding box data\n      //\n      const data: ScriptData = this.scriptData = {\n        base: null, sub: BBox.empty(), sup: BBox.empty(), psub: BBox.empty(), psup: BBox.empty(),\n        numPrescripts: 0, numScripts: 0\n      };\n      //\n      //  Get the bboxes for all the scripts and combine them into the scriptData\n      //\n      const lists = this.getScriptBBoxLists();\n      this.combineBBoxLists(data.sub, data.sup, lists.subList, lists.supList);\n      this.combineBBoxLists(data.psub, data.psup, lists.psubList, lists.psupList);\n      data.base = lists.base[0];\n      //\n      //  Save the lengths and return the data\n      //\n      data.numPrescripts = lists.psubList.length;\n      data.numScripts = lists.subList.length;\n    }\n\n    /**\n     * @return {ScriptLists}  The bounding boxes for all the scripts divided into lists by position\n     */\n    public getScriptBBoxLists(): ScriptLists {\n      const lists: ScriptLists = {\n        base: [], subList: [], supList: [], psubList: [], psupList: []\n      };\n      //\n      // The first entry is the base, and then they altername sub- and superscripts.\n      // Once we find the <mprescripts/> element, switch to presub- and presuperscript lists.\n      //\n      let script: ScriptListName = 'base';\n      for (const child of this.childNodes) {\n        if (child.node.isKind('mprescripts')) {\n          script = 'psubList';\n        } else {\n          lists[script].push(child.getBBox());\n          script = NextScript[script];\n        }\n      }\n      //\n      //  The index of the first prescript (skip over base, sub- and superscripts, and mprescripts)\n      //\n      this.firstPrescript = lists.subList.length + lists.supList.length + 2;\n      //\n      //  Make sure the lists are the same length\n      //\n      this.padLists(lists.subList, lists.supList);\n      this.padLists(lists.psubList, lists.psupList);\n      return lists;\n    }\n\n    /**\n     * Pad the second list, if it is one short\n     *\n     * @param {BBox[]} list1   The first list\n     * @param {BBox[]} list2   The second list\n     */\n    public padLists(list1: BBox[], list2: BBox[]) {\n      if (list1.length > list2.length) {\n        list2.push(BBox.empty());\n      }\n    }\n\n    /**\n     * @param {BBox} bbox1    The bbox for the combined subscripts\n     * @param {BBox} bbox2    The bbox for the combined superscripts\n     * @param {BBox[]} list1  The list of subscripts to combine\n     * @param {BBox[]} list2  The list of superscripts to combine\n     */\n    public combineBBoxLists(bbox1: BBox, bbox2: BBox, list1: BBox[], list2: BBox[]) {\n      for (let i = 0; i < list1.length; i++) {\n        const [w1, h1, d1] = this.getScaledWHD(list1[i]);\n        const [w2, h2, d2] = this.getScaledWHD(list2[i]);\n        const w = Math.max(w1, w2);\n        bbox1.w += w;\n        bbox2.w += w;\n        if (h1 > bbox1.h) bbox1.h = h1;\n        if (d1 > bbox1.d) bbox1.d = d1;\n        if (h2 > bbox2.h) bbox2.h = h2;\n        if (d2 > bbox2.d) bbox2.d = d2;\n      }\n    }\n\n    /**\n     * @param {BBox} bbox  The bounding box from which to get the (scaled) width, height, and depth\n     */\n    public getScaledWHD(bbox: BBox) {\n      const {w, h, d, rscale} = bbox;\n      return [w * rscale, h * rscale, d * rscale];\n    }\n\n    /*************************************************************/\n\n    /**\n     * @override\n     */\n    public getUVQ(subbox: BBox, supbox: BBox) {\n      if (!this.UVQ) {\n        let [u, v, q] = [0, 0, 0];\n        if (subbox.h === 0 && subbox.d === 0) {\n          //\n          //  Use placement for superscript only\n          //\n          u = this.getU();\n        } else if (supbox.h === 0 && supbox.d === 0) {\n          //\n          //  Use placement for subsccript only\n          //\n          u = -this.getV();\n        } else {\n          //\n          //  Use placement for both\n          //\n          [u, v, q] = super.getUVQ(subbox, supbox);\n        }\n        this.UVQ = [u, v, q];\n      }\n      return this.UVQ;\n    }\n\n  };\n\n}\n"]},"metadata":{},"sourceType":"script"}